{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management - Woodora Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        :root {
            --primary: #2C1810;
            --secondary: #A67C52;
            --accent: #E8C39E;
            --dark: #1a0f0a;
            --light: #FAF7F2;
            --gray: #8B8680;
            --white: #FFFFFF;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--light);
            color: var(--primary);
            overflow-x: hidden;
        }
        h1, h2, h3, h4, h5 {
            font-family: 'Cormorant Garamond', serif;
        }
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 80px;
            height: 100vh;
            background: linear-gradient(180deg, var(--dark) 0%, var(--primary) 100%);
            transition: width 0.3s ease;
            overflow: hidden;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 4px 0 20px rgba(0,0,0,0.1);
        }
        .sidebar.expanded {
            width: 280px;
        }
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .toggle-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s ease;
        }
        .toggle-btn:hover {
            color: var(--accent);
            transform: rotate(90deg);
        }
        .sidebar-title {
            display: none;
            font-family: 'Cormorant Garamond', serif;
            color: var(--accent);
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 2px;
        }
        .sidebar.expanded .sidebar-title {
            display: block;
        }
        .sidebar-content {
            padding: 20px 0;
        }
        .sidebar a {
            display: flex;
            align-items: center;
            padding: 18px 25px;
            color: var(--accent);
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
        }
        .sidebar a::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 0;
            background: var(--accent);
            transition: height 0.3s ease;
        }
        .sidebar a:hover,
        .sidebar a.active {
            background: rgba(166, 124, 82, 0.1);
            color: white;
        }
        .sidebar a:hover::before,
        .sidebar a.active::before {
            height: 100%;
        }
        .sidebar a i {
            font-size: 15px;
            min-width: 30px;
        }
        .sidebar a .link-text {
            display: none;
            margin-left: 15px;
            font-size: 12px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        .sidebar.expanded a .link-text {
            display: inline;
        }
        .main-content {
            margin-left: 80px;
            padding: 30px;
            transition: margin-left 0.3s ease;
            min-height: 100vh;
        }
        .main-content.expanded {
            margin-left: 280px;
        }
        .view-section {
            display: none;
        }
        .view-section.active {
            display: block;
        }
        .page-header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .page-title {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        .page-subtitle {
            color: var(--gray);
            font-size: 14px;
        }
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 15px;
        }
        .stat-card:nth-child(1) .stat-icon {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }
        .stat-card:nth-child(2) .stat-icon {
            background: rgba(166, 124, 82, 0.1);
            color: var(--secondary);
        }
        .stat-card:nth-child(3) .stat-icon {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }
        .stat-card:nth-child(4) .stat-icon {
            background: rgba(23, 162, 184, 0.1);
            color: var(--info);
        }
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 13px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .filter-bar {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .filter-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .filter-select {
            padding: 10px 20px;
            border: 2px solid var(--light);
            border-radius: 8px;
            background: white;
            color: var(--primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .filter-select:focus {
            outline: none;
            border-color: var(--secondary);
        }
        .search-box {
            position: relative;
            width: 300px;
        }
        .search-box input {
            width: 100%;
            padding: 10px 40px 10px 20px;
            border: 2px solid var(--light);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .search-box input:focus {
            outline: none;
            border-color: var(--secondary);
        }
        .search-box i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }
        .table-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .table-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .table-header h2 {
            color: white;
            font-size: 24px;
            font-weight: 600;
            margin: 0;
        }
        .btn-add {
            background: white;
            color: var(--primary);
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .btn-add:hover {
            background: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .product-table {
            width: 100%;
            border-collapse: collapse;
        }
        .product-table thead {
            background: var(--light);
        }
        .product-table th {
            padding: 18px 20px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .product-table td {
            padding: 20px;
            border-bottom: 1px solid var(--light);
            vertical-align: middle;
        }
        .product-table tbody tr {
            transition: all 0.3s ease;
        }
        .product-table tbody tr:hover {
            background: rgba(166, 124, 82, 0.05);
        }
        .product-img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .product-name {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 3px;
        }
        .product-category {
            font-size: 12px;
            color: var(--gray);
        }
        .product-description {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: var(--gray);
            font-size: 13px;
        }
        .status-badge {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        .status-badge.listed {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }
        .status-badge.unlisted {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }
        .action-dropdown {
            position: relative;
        }
        .action-btn {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 20px;
            padding: 5px 10px;
            transition: all 0.3s ease;
        }
        .action-btn:hover {
            color: var(--secondary);
        }
        .dropdown-menu {
            min-width: 180px;
            border: none;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            border-radius: 8px;
            padding: 10px 0;
        }
        .dropdown-item {
            padding: 12px 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        .dropdown-item:hover {
            background: var(--light);
        }
        .dropdown-item i {
            width: 18px;
        }
        .dropdown-item.list-action {
            background: var(--success);
            color: white;
            margin: 5px 10px;
            border-radius: 5px;
        }
        .dropdown-item.unlist-action {
            background: var(--danger);
            color: white;
            margin: 5px 10px;
            border-radius: 5px;
        }
        .form-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.05);
            max-width: 1200px;
        }
        .form-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .form-header h2 {
            color: white;
            font-size: 28px;
            font-weight: 600;
            margin: 0;
        }
        .btn-back {
            background: white;
            color: var(--primary);
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        .btn-back:hover {
            background: var(--accent);
            text-decoration: none;
            color: var(--primary);
        }
        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .section-title i {
            color: var(--secondary);
        }
        .form-group label {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 14px;
            display: block;
        }
        .form-control {
            border: 2px solid var(--light);
            border-radius: 8px;
            padding: 12px 18px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .form-control:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 0.2rem rgba(166, 124, 82, 0.1);
        }
        .required {
            color: var(--danger);
            margin-left: 3px;
        }
        .helper-text {
            font-size: 12px;
            color: var(--gray);
            margin-top: 5px;
        }
        .image-upload-area {
            border: 3px dashed var(--secondary);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: var(--light);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        .image-upload-area:hover {
            background: var(--accent);
            border-color: var(--primary);
        }
        .image-upload-area i {
            font-size: 48px;
            color: var(--secondary);
            margin-bottom: 15px;
        }
        .image-upload-area p {
            color: var(--gray);
            margin: 0;
            font-size: 14px;
        }
        .image-upload-area input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        .image-preview-container {
            display: none;
            margin-top: 25px;
        }
        .image-preview-container.active {
            display: block;
        }
        #imagePreview {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            max-height: 500px;
            object-fit: contain;
        }
        .zoom-controls {
            display: none;
            margin-top: 20px;
            gap: 15px;
        }
        .zoom-controls.active {
            display: flex;
        }
        .zoom-btn {
            flex: 1;
            padding: 14px;
            background: var(--light);
            border: 2px solid var(--secondary);
            color: var(--primary);
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .zoom-btn:hover {
            background: var(--secondary);
            color: white;
        }
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid var(--light);
        }
        .btn-submit {
            flex: 1;
            background: var(--primary);
            color: white;
            padding: 16px 40px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn-submit:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        .btn-cancel {
            flex: 1;
            background: var(--gray);
            color: white;
            padding: 16px 40px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn-cancel:hover {
            background: var(--danger);
        }
        @media (max-width: 1200px) {
            .stats-row {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 80px;
            }

            .sidebar.expanded {
                width: 100%;
            }

            .main-content {
                margin-left: 0;
                padding: 15px;
            }

            .main-content.expanded {
                margin-left: 0;
            }

            .stats-row {
                grid-template-columns: 1fr;
            }

            .filter-bar {
                flex-direction: column;
            }

            .search-box {
                width: 100%;
            }

            .page-title {
                font-size: 28px;
            }

            .product-table {
                font-size: 12px;
            }

            .product-table th,
            .product-table td {
                padding: 12px 10px;
            }
        }
        .sidebar::-webkit-scrollbar {
            width: 5px;
        }
        .sidebar::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
        }
        .sidebar::-webkit-scrollbar-thumb {
            background: var(--secondary);
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button id="toggleButton" class="toggle-btn">
                <i class="fas fa-bars"></i>
            </button>
            
            <span class="sidebar-title">WOODORA</span>
        </div>  
        <div class="sidebar-content">
            <a href="#">
                <i class="fas fa-tachometer-alt"></i>
                <span class="link-text">Dashboard</span>
            </a>
            <a href="{% url 'users' %}">
                <i class="fas fa-users"></i>
                <span class="link-text">Customers</span>
            </a>
            <a href="{% url 'products' %}" class="active">
                <i class="fas fa-couch"></i>
                <span class="link-text">Products</span>
            </a>
            <a href="#">
                <i class="fas fa-shopping-cart"></i>
                <span class="link-text">Orders</span>
            </a>
            <a href="#">
                <i class="fas fa-tags"></i>
                <span class="link-text">Offers</span>
            </a>
            <a href="{% url 'brand' %}">
                <i class="fas fa-certificate"></i>
                <span class="link-text">Brands</span>
            </a>
            
            <a href="#">
                <i class="fas fa-chart-bar"></i>
                <span class="link-text">Reports</span>
            </a>
            <a href="{% url 'Edition' %}">
                <i class="fas fa-bookmark"></i>
                <span class="link-text">Collections</span>
            </a>
            <a href="{% url 'type1' %}">
                <i class="fas fa-th-large"></i>
                <span class="link-text">Types</span>
            </a>
        </div>
    </div>
    <div class="main-content" id="mainContent">
        <div id="listView" class="view-section active">
            <div class="page-header">
                <h1 class="page-title">Product Management</h1>
                <p class="page-subtitle">Manage your furniture inventory and listings</p>
            </div>
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-box"></i>
                    </div>
                    <div class="stat-value">{{ products|length }}</div>
                    <div class="stat-label">Total Products</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-value">
                        {% with listed=products|length %}{{ listed }}{% endwith %}
                    </div>
                    <div class="stat-label">Listed Items</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-value">12</div>
                    <div class="stat-label">Low Stock</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-value">$24.5K</div>
                    <div class="stat-label">Total Value</div>
                </div>
            </div>
            <div class="filter-bar">
                <div class="filter-group">
                    <select id="filter" class="filter-select">
                        <option value="all">All Products</option>
                        <option value="listed">Listed</option>
                        <option value="delisted">Unlisted</option>
                    </select>
                    <select id="sort" class="filter-select">
                        <option value="name">Sort by Name</option>
                        <option value="date">Sort by Date</option>
                        <option value="price">Sort by Price</option>
                        <option value="stock">Sort by Stock</option>
                    </select>
                </div>
                <div class="search-box">
                    <input type="search" id="search" placeholder="Search products...">
                    <i class="fas fa-search"></i>
                </div>
            </div>
            <div class="table-container">
                <div class="table-header">
                    <h2>All Products</h2>
                    <button class="btn-add" id="showAddForm">
                        <i class="fas fa-plus"></i>
                        Add New Product
                    </button>
                </div>
                <table class="product-table">
                    <thead>
                        <tr>
                            <th style="width: 5%;">#</th>
                            <th style="width: 10%;">Image</th>
                            <th style="width: 20%;">Product</th>
                            <th style="width: 25%;">Description</th>
                            <th style="width: 10%;">Price</th>
                            <th style="width: 8%;">Stock</th>
                            <th style="width: 10%;">Status</th>
                            <th style="width: 7%;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in products %}
                        <tr data-status="{{ i.status }}">
                            <td>{{ forloop.counter }}</td>
                            <td>
                                {% if i.image %}
                                    <img src="{{ i.image.url }}" alt="{{ i.name }}" class="product-img">
                                {% else %}
                                    <div style="width:60px;height:60px;background:var(--light);border-radius:8px;display:flex;align-items:center;justify-content:center;">
                                        <i class="fas fa-image" style="color:var(--gray);"></i>
                                    </div>
                                {% endif %}
                            </td>
                            <td>
                                <div class="product-name">{{ i.name }}</div>
                                <div class="product-category">Living Room</div>
                            </td>
                            <td>
                                <div class="product-description">{{ i.description }}</div>
                            </td>
                            <td>
                                <strong style="color:var(--secondary);font-size:16px;">${{ i.price }}</strong>
                            </td>
                            <td>
                                <span style="font-weight:600;">{{ i.stock }}</span>
                            </td>
                            <td>
                                <span class="status-badge {% if i.status == 'listed' %}listed{% else %}unlisted{% endif %}">
                                    {{ i.status }}
                                </span>
                            </td>
                            <td>
                                <div class="dropdown action-dropdown">
                                    <button class="action-btn" type="button" data-toggle="dropdown">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <form method="POST" action="{% url 'list_products' %}" style="margin:0;">
                                            {% csrf_token %}
                                            <input type="hidden" name="status" value="{% if i.status == 'listed' %}unlisted{% else %}listed{% endif %}">
                                            <button type="submit" class="dropdown-item {% if i.status == 'listed' %}unlist-action{% else %}list-action{% endif %}">
                                                <i class="fas {% if i.status == 'listed' %}fa-eye-slash{% else %}fa-eye{% endif %}"></i>
                                                {% if i.status == 'listed' %}Unlist{% else %}List{% endif %}
                                            </button>
                                        </form>
                                        <a href="#" class="dropdown-item" data-toggle="modal" data-target="#editModal{{ i.id }}">
                                            <i class="fas fa-edit"></i> Edit Product
                                        </a>
                                        <a href="{% url 'variants' i.id %}" class="dropdown-item">
                                            <i class="fas fa-cogs"></i> Manage Variants
                                        </a>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <div id="addView" class="view-section">
            <div class="form-container">
                <div class="form-header">
                    <h2>Add New Product</h2>
                    <button class="btn-back" id="showListView">
                        <i class="fas fa-arrow-left"></i>
                        Back to Products
                    </button>
                </div>
                <form action="{% url 'add_products' %}" id="addProductForm" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="section-title">
                        <i class="fas fa-info-circle"></i>
                        Basic Information
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Product Name <span class="required">*</span></label>
                                <input type="text" class="form-control" name="name" placeholder="e.g., Oak Dining Table" required>
                                <span class="helper-text">Enter a descriptive name for the product</span>
                            </div>
       
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                            <label>Edition(s)</label>
                            <select name="editions" multiple class="form-control">
                                {% for e in editions %}
                                    <option value="{{ e.id }}">{{ e.edition_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                                <label>Type(s)</label>
                                <select name="types" multiple class="form-control">
                                    {% for t in types %}
                                        <option value="{{ t.id }}">{{ t.name }}</option>
                                    {% endfor %}
                                </select>
                                <small>Hold Ctrl (Windows) or Cmd (Mac) to select multiple types</small>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Description <span class="required">*</span></label>
                        <textarea class="form-control" name="description" rows="4" placeholder="Describe the product features, materials, dimensions, etc." required></textarea>
                        <span class="helper-text">Provide a detailed description to help customers</span>
                    </div>
                    <div class="section-title" style="margin-top: 40px;">
                        <i class="fas fa-cogs"></i>
                        Product Details
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>Brand <span class="required">*</span></label>
                                <select class="form-control" name="brand" required>
                                    <option value="">Select a brand</option>
                                    {% for brand in brands %}
                                        <option value="{{ brand.id }}">{{ brand.brand_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>Price ($) <span class="required">*</span></label>
                                <input type="number" class="form-control" name="price" placeholder="0.00" required min="0" step="0.01">
                                <span class="helper-text">Enter product price in dollars</span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>Stock Quantity <span class="required">*</span></label>
                                <input type="number" class="form-control" name="stock" placeholder="0" required min="0" step="1">
                                <span class="helper-text">Available units in inventory</span>
                            </div>
                        </div>
                    </div>
                    <div class="section-title" style="margin-top: 40px;">
                        <i class="fas fa-image"></i>
                        Product Image
                    </div>
                    <div class="image-upload-area" id="uploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p><strong>Click to upload</strong> or drag and drop</p>
                        <p>PNG, JPG, JPEG (MAX. 5MB)</p>
                        <input type="file" id="mainImage" accept="image/*" required>
                    </div>
                    <div class="image-preview-container" id="previewContainer">
                        <img id="imagePreview" alt="Product Preview">
                    </div>
                    <div class="zoom-controls" id="zoomControls">
                        <button type="button" id="zoomIn" class="zoom-btn">
                            <i class="fas fa-search-plus"></i>
                            Zoom In
                        </button>
                        <button type="button" id="zoomOut" class="zoom-btn">
                            <i class="fas fa-search-minus"></i>
                            Zoom Out
                        </button>
                        <button type="button" id="resetCrop" class="zoom-btn">
                            <i class="fas fa-redo"></i>
                            Reset
                        </button>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-cancel" id="cancelAdd">
                            <i class="fas fa-times"></i>
                            Cancel
                        </button>
                        <button type="button" id="submitBtn" class="btn-submit">
                            <i class="fas fa-plus-circle"></i>
                            Add Product
                        </button>
                    </div>

                </form>
            </div>
        </div>

    </div>
    {% for i in products %}
    <div class="modal fade" id="editModal{{ i.id }}" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title" style="font-size: 24px; font-weight: 600;">Edit Product</h5>
                    <button type="button" class="close" data-dismiss="modal" style="color: white; opacity: 1;">
                        <span>&times;</span>
                    </button>
                </div>
                <form action="{% url 'edit_products' i.id %}" id="editProductForm{{ i.id }}" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="modal-body" style="padding: 30px;">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Product Name</label>
                                    <input type="text" class="form-control" name="name" value="{{ i.name }}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label>Category</label>
                                    <select class="form-control" name="category" required>
                                        <option value="">Select Category</option>
                                        {% for category in categories %}
                                            <option value="{{ category.id }}" {% if category.id == i.category.id %}selected{% endif %}>{{ category.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Description</label>
                            <textarea class="form-control" name="description" rows="3" required>{{ i.description }}</textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Brand</label>
                                    <select class="form-control" name="brand" required>
                                        <option value="">Select Brand</option>
                                        {% for brand in brands %}
                                            <option value="{{ brand.id }}" {% if brand.id == i.brand.id %}selected{% endif %}>{{ brand.brand_name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Price ($)</label>
                                    <input type="number" class="form-control" name="price" value="{{ i.price }}" required min="0" step="0.01">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Stock Quantity</label>
                                    <input type="number" class="form-control" name="stock" value="{{ i.stock }}" required min="0" step="1">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Product Image</label>
                            <input type="file" class="form-control-file" id="editImage{{ i.id }}" accept="image/*">
                            {% if i.image %}
                                <img src="{{ i.image.url }}" alt="{{ i.name }}" style="width: 100%; max-width: 300px; margin-top: 15px; border-radius: 10px;">
                            {% endif %}
                        </div>
                    </div>
                    <div class="modal-footer" style="border: none; padding: 20px 30px;">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal" style="padding: 12px 30px; border-radius: 8px; font-weight: 600;">Cancel</button>
                        <button type="submit" class="btn btn-primary" style="padding: 12px 30px; border-radius: 8px; font-weight: 600; background: var(--primary); border: none;">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
        const toggleButton = document.getElementById('toggleButton');
        const sidebar      = document.getElementById('sidebar');
        const mainContent  = document.getElementById('mainContent');
        if (toggleButton && sidebar && mainContent) {
            toggleButton.addEventListener('click', function () {
                sidebar.classList.toggle('expanded');
                mainContent.classList.toggle('expanded');
            });
        }
        const showAddForm   = document.getElementById('showAddForm');
        const showListView  = document.getElementById('showListView');
        const cancelAdd     = document.getElementById('cancelAdd');
        const listView      = document.getElementById('listView');
        const addView       = document.getElementById('addView');
        function switchTo(viewToShow, viewToHide) {
            viewToHide.classList.remove('active');
            viewToShow.classList.add('active');
            window.scrollTo(0, 0);
        }

        if (showAddForm && listView && addView) {
            showAddForm.addEventListener('click', () => switchTo(addView, listView));
        }
        if (showListView && listView && addView) {
            showListView.addEventListener('click', () => switchTo(listView, addView));
        }
        if (cancelAdd && listView && addView) {
            cancelAdd.addEventListener('click', () => switchTo(listView, addView));
        }

        
        const searchInput = document.getElementById('search');
        if (searchInput) {
            searchInput.addEventListener('keyup', function () {
                const term = this.value.trim().toLowerCase();
                const rows = document.querySelectorAll('.product-table tbody tr');

                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(term) ? '' : 'none';
                });
            });
        }

        
        const filterSelect = document.getElementById('filter');
        if (filterSelect) {
            filterSelect.addEventListener('change', function () {
                const status = this.value; 
                const rows   = document.querySelectorAll('.product-table tbody tr');

                rows.forEach(row => {
                    if (status === 'all') {
                        row.style.display = '';
                    } else {
                        const rowStatus = row.getAttribute('data-status');
                        row.style.display = (rowStatus === status) ? '' : 'none';
                    }
                });
            });
        }

        
        const sortSelect = document.getElementById('sort');
        if (sortSelect) {
            sortSelect.addEventListener('change', function () {
                const sortBy = this.value;
                const tbody  = document.querySelector('.product-table tbody');
                const rows   = Array.from(tbody.querySelectorAll('tr'));

                rows.sort((a, b) => {
                    let aVal, bVal;

                    switch (sortBy) {
                        case 'name':
                            aVal = a.querySelector('.product-name').textContent.trim();
                            bVal = b.querySelector('.product-name').textContent.trim();
                            return aVal.localeCompare(bVal);

                        case 'price':
                            const extractNum = txt => {
                                const num = txt.replace(/[^0-9.-]+/g, '');
                                return parseFloat(num) || 0;
                            };
                            aVal = extractNum(a.cells[4].textContent);
                            bVal = extractNum(b.cells[4].textContent);
                            return aVal - bVal;

                        case 'stock':
                            aVal = parseInt(a.cells[5].textContent, 10) || 0;
                            bVal = parseInt(b.cells[5].textContent, 10) || 0;
                            return aVal - bVal;

                        default:
                            return 0;
                    }
                });

                rows.forEach(row => tbody.appendChild(row));
            });
        }

        let cropper;
        const mainImage      = document.getElementById('mainImage');
        const imagePreview   = document.getElementById('imagePreview');
        const previewContainer = document.getElementById('previewContainer');
        const zoomControls   = document.getElementById('zoomControls');
        const uploadArea     = document.getElementById('uploadArea');

        if (mainImage && imagePreview) {
            mainImage.addEventListener('change', function (e) {
                const files = e.target.files;
                if (!files || files.length === 0) return;

                const file = files[0];
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size must be less than 5 MB');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (ev) {
                    imagePreview.src = ev.target.result;
                    previewContainer.classList.add('active');
                    zoomControls.classList.add('active');
                    uploadArea.style.display = 'none';

                    if (cropper) cropper.destroy();

                    cropper = new Cropper(imagePreview, {
                        aspectRatio: 4 / 3,
                        viewMode: 1,
                        autoCropArea: 1,
                        responsive: true,
                        zoomable: true,
                    });
                };
                reader.readAsDataURL(file);
            });
        }


        const zoomIn  = document.getElementById('zoomIn');
        const zoomOut = document.getElementById('zoomOut');
        const resetCrop = document.getElementById('resetCrop');

        if (zoomIn)   zoomIn.addEventListener('click',   () => cropper && cropper.zoom(0.1));
        if (zoomOut)  zoomOut.addEventListener('click',  () => cropper && cropper.zoom(-0.1));
        if (resetCrop) resetCrop.addEventListener('click', () => cropper && cropper.reset());


        const submitBtn = document.getElementById('submitBtn');
        const addForm   = document.getElementById('addProductForm');

        if (submitBtn && addForm) {
            submitBtn.addEventListener('click', function () {
                if (!addForm.checkValidity()) {
                    addForm.reportValidity();
                    return;
                }

            
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                submitBtn.disabled = true;

                if (cropper) {
                    cropper.getCroppedCanvas().toBlob(blob => {
                        if (!blob) {
                            alert('Could not crop the image.');
                            resetBtn();
                            return;
                        }

                        const formData = new FormData(addForm);
                        formData.append('main_image', blob, 'product-image.png');

                        fetch(addForm.action, {
                            method: 'POST',
                            body: formData,
                            headers: { 'X-Requested-With': 'XMLHttpRequest' }
                        })
                        .then(r => {
                            if (!r.ok) throw new Error('Network error');
                            return r.text();
                        })
                        .then(() => location.reload())
                        .catch(err => {
                            console.error(err);
                            alert('Error adding product. Please try again.');
                            resetBtn();
                        });
                    }, 'image/png');
                } else {
            
                    addForm.submit();
                }
            });
        }

        function resetBtn() {
            submitBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Add Product';
            submitBtn.disabled = false;
        }


        const requiredInputs = document.querySelectorAll('input[required], select[required], textarea[required]');
        requiredInputs.forEach(el => {
            const setBorder = (valid) => el.style.borderColor = valid ? 'var(--success)' : 'var(--danger)';

            el.addEventListener('blur', () => setBorder(!!el.value));
            el.addEventListener('input', () => {
                if (el.value) setBorder(true);
            });
        });

    });
</script>

</body>
</html> 